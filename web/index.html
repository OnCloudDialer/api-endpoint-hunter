<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Endpoint Hunter</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0a0f;
            --bg-secondary: #12121a;
            --bg-tertiary: #1a1a25;
            --bg-card: #16161f;
            --border-color: #2a2a3a;
            --text-primary: #f0f0f5;
            --text-secondary: #8888a0;
            --text-muted: #5a5a70;
            --accent-primary: #6366f1;
            --accent-secondary: #818cf8;
            --accent-glow: rgba(99, 102, 241, 0.3);
            --success: #22c55e;
            --warning: #f59e0b;
            --error: #ef4444;
            --method-get: #22c55e;
            --method-post: #3b82f6;
            --method-put: #f59e0b;
            --method-patch: #a855f7;
            --method-delete: #ef4444;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Outfit', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Background effects */
        .bg-grid {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                linear-gradient(rgba(99, 102, 241, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(99, 102, 241, 0.03) 1px, transparent 1px);
            background-size: 50px 50px;
            pointer-events: none;
            z-index: 0;
        }

        .bg-glow {
            position: fixed;
            width: 600px;
            height: 600px;
            border-radius: 50%;
            background: radial-gradient(circle, var(--accent-glow) 0%, transparent 70%);
            filter: blur(80px);
            pointer-events: none;
            z-index: 0;
            opacity: 0.5;
        }

        .bg-glow-1 { top: -200px; left: -200px; }
        .bg-glow-2 { bottom: -200px; right: -200px; background: radial-gradient(circle, rgba(34, 197, 94, 0.2) 0%, transparent 70%); }

        /* Layout */
        .container {
            position: relative;
            z-index: 1;
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Header */
        header {
            text-align: center;
            margin-bottom: 3rem;
            padding-top: 2rem;
        }

        .logo {
            display: inline-flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .logo-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            box-shadow: 0 8px 32px var(--accent-glow);
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--text-primary), var(--text-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .tagline {
            color: var(--text-secondary);
            font-size: 1.1rem;
            font-weight: 300;
        }

        /* Main grid */
        .main-grid {
            display: grid;
            grid-template-columns: 400px 1fr;
            gap: 2rem;
            align-items: start;
        }

        @media (max-width: 1024px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Cards */
        .card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            overflow: hidden;
        }

        .card-header {
            padding: 1.25rem 1.5rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .card-header h2 {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .card-header-icon {
            font-size: 1.25rem;
        }

        .card-body {
            padding: 1.5rem;
        }

        /* Form */
        .form-group {
            margin-bottom: 1.25rem;
        }

        .form-group:last-child {
            margin-bottom: 0;
        }

        label {
            display: block;
            font-size: 0.85rem;
            font-weight: 500;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        input, textarea, select {
            width: 100%;
            padding: 0.875rem 1rem;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            color: var(--text-primary);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            transition: all 0.2s ease;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px var(--accent-glow);
        }

        input::placeholder {
            color: var(--text-muted);
        }

        /* Collapsible sections */
        .collapsible {
            border: 1px solid var(--border-color);
            border-radius: 10px;
            margin-bottom: 1rem;
            overflow: hidden;
        }

        .collapsible-header {
            padding: 1rem;
            background: var(--bg-tertiary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            user-select: none;
            transition: background 0.2s ease;
        }

        .collapsible-header:hover {
            background: var(--bg-secondary);
        }

        .collapsible-header h3 {
            font-size: 0.9rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .collapsible-arrow {
            transition: transform 0.2s ease;
        }

        .collapsible.open .collapsible-arrow {
            transform: rotate(180deg);
        }

        .collapsible-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .collapsible.open .collapsible-content {
            max-height: 500px;
        }

        .collapsible-inner {
            padding: 1rem;
            border-top: 1px solid var(--border-color);
        }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 1rem 2rem;
            border: none;
            border-radius: 10px;
            font-family: 'Outfit', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: white;
            box-shadow: 0 4px 20px var(--accent-glow);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px var(--accent-glow);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            pointer-events: none;
            box-shadow: none;
        }

        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
            background: var(--bg-secondary);
            border-color: var(--text-muted);
        }

        .btn-danger {
            background: var(--error);
            color: white;
        }

        .btn-full {
            width: 100%;
        }

        /* Progress */
        .progress-section {
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--border-color);
        }

        .progress-bar-container {
            background: var(--bg-tertiary);
            border-radius: 8px;
            height: 8px;
            overflow: hidden;
            margin-bottom: 1rem;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
            border-radius: 8px;
            transition: width 0.3s ease;
            width: 0%;
        }

        .progress-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
        }

        .stat {
            text-align: center;
            padding: 1rem;
            background: var(--bg-tertiary);
            border-radius: 10px;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent-secondary);
            font-family: 'JetBrains Mono', monospace;
        }

        .stat-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-top: 0.25rem;
        }

        /* Status messages */
        .status-message {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 1rem;
            background: var(--bg-tertiary);
            border-radius: 10px;
            margin-bottom: 1rem;
            font-size: 0.9rem;
        }

        .status-message.success {
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid rgba(34, 197, 94, 0.3);
        }

        .status-message.error {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        /* Endpoints list */
        .endpoints-panel {
            max-height: 600px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .endpoints-list {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
        }

        .endpoints-list::-webkit-scrollbar {
            width: 6px;
        }

        .endpoints-list::-webkit-scrollbar-track {
            background: var(--bg-tertiary);
        }

        .endpoints-list::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 3px;
        }

        /* Snapshots Gallery */
        .snapshots-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
            padding: 1rem;
        }

        .snapshot-item {
            position: relative;
            border-radius: 8px;
            overflow: hidden;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .snapshot-item:hover {
            transform: scale(1.02);
            border-color: var(--accent-primary);
        }

        .snapshot-item img {
            width: 100%;
            height: 150px;
            object-fit: cover;
        }

        .snapshot-item .snapshot-info {
            padding: 0.75rem;
            font-size: 0.75rem;
        }

        .snapshot-item .snapshot-info .page-num {
            color: var(--accent-primary);
            font-weight: 600;
        }

        .snapshot-item .snapshot-info .url {
            color: var(--text-secondary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            display: block;
            margin-top: 0.25rem;
        }

        /* Snapshot Modal (lightbox) */
        .snapshot-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            z-index: 2000;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .snapshot-modal.active {
            opacity: 1;
            visibility: visible;
        }

        .snapshot-modal img {
            max-width: 90vw;
            max-height: 90vh;
            object-fit: contain;
            border-radius: 8px;
        }

        .snapshot-modal .close-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: var(--bg-secondary);
            border: none;
            color: white;
            font-size: 1.5rem;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
        }

        .snapshot-modal .snapshot-details {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--bg-secondary);
            padding: 1rem 2rem;
            border-radius: 8px;
            text-align: center;
        }

        .endpoint-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: var(--bg-tertiary);
            border-radius: 10px;
            margin-bottom: 0.75rem;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .endpoint-item:hover {
            background: var(--bg-secondary);
            transform: translateX(4px);
        }

        .endpoint-method {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.75rem;
            font-weight: 600;
            padding: 0.35rem 0.6rem;
            border-radius: 6px;
            min-width: 60px;
            text-align: center;
        }

        .method-GET { background: rgba(34, 197, 94, 0.15); color: var(--method-get); }
        .method-POST { background: rgba(59, 130, 246, 0.15); color: var(--method-post); }
        .method-PUT { background: rgba(245, 158, 11, 0.15); color: var(--method-put); }
        .method-PATCH { background: rgba(168, 85, 247, 0.15); color: var(--method-patch); }
        .method-DELETE { background: rgba(239, 68, 68, 0.15); color: var(--method-delete); }

        .endpoint-path {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            color: var(--text-primary);
            flex: 1;
        }

        .endpoint-count {
            font-size: 0.75rem;
            color: var(--text-muted);
            background: var(--bg-primary);
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
        }

        /* Empty state */
        .empty-state {
            text-align: center;
            padding: 3rem 2rem;
            color: var(--text-muted);
        }

        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .empty-state p {
            font-size: 0.9rem;
        }

        /* Download buttons */
        .download-buttons {
            display: flex;
            gap: 0.75rem;
            padding: 1rem;
            border-top: 1px solid var(--border-color);
        }

        .download-buttons .btn-group {
            display: flex;
            flex: 1;
        }

        .download-buttons .btn-group .btn:first-child {
            flex: 1;
            border-radius: 8px 0 0 8px;
        }

        .download-buttons .btn-group .btn:last-child {
            border-radius: 0 8px 8px 0;
            padding: 0.75rem 1rem;
            border-left: 1px solid var(--border-color);
        }

        .download-buttons .btn {
            padding: 0.75rem;
            font-size: 0.85rem;
        }

        .btn-outline {
            background: transparent;
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
        }

        .btn-outline:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        /* Live log */
        .live-log {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
            background: var(--bg-primary);
            border-radius: 8px;
            padding: 1rem;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 1rem;
        }

        .log-entry {
            padding: 0.25rem 0;
            color: var(--text-secondary);
            display: flex;
            gap: 0.5rem;
        }

        .log-entry .time {
            color: var(--text-muted);
        }

        .log-entry.api {
            color: var(--accent-secondary);
        }

        /* Animations */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .loading {
            animation: pulse 1.5s ease-in-out infinite;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-in {
            animation: slideIn 0.3s ease forwards;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(8px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            padding: 2rem;
            max-width: 420px;
            width: 90%;
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }

        .modal-overlay.active .modal {
            transform: scale(1);
        }

        .modal-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--warning), #f97316);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            margin: 0 auto 1.5rem;
            box-shadow: 0 8px 32px rgba(245, 158, 11, 0.3);
        }

        .modal h2 {
            text-align: center;
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }

        .modal p {
            text-align: center;
            color: var(--text-secondary);
            margin-bottom: 1.5rem;
            font-size: 0.95rem;
        }

        .code-input-group {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
            margin-bottom: 1.5rem;
        }

        .code-input {
            width: 50px;
            height: 60px;
            text-align: center;
            font-size: 1.5rem;
            font-family: 'JetBrains Mono', monospace;
            font-weight: 600;
            background: var(--bg-tertiary);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            color: var(--text-primary);
            transition: all 0.2s ease;
        }

        .code-input:focus {
            outline: none;
            border-color: var(--warning);
            box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.2);
        }

        .modal-timer {
            text-align: center;
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-top: 1rem;
        }

        .modal-timer span {
            color: var(--warning);
            font-weight: 600;
            font-family: 'JetBrains Mono', monospace;
        }

        /* Profile bar */
        .profile-bar {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.25rem;
            padding-bottom: 1.25rem;
            border-bottom: 1px solid var(--border-color);
        }

        .profile-bar select {
            flex: 1;
            padding: 0.75rem 1rem;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            font-family: 'Outfit', sans-serif;
            font-size: 0.9rem;
            cursor: pointer;
        }

        .profile-bar select:focus {
            outline: none;
            border-color: var(--accent-primary);
        }

        .btn-icon {
            width: 42px;
            height: 42px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-icon:hover {
            background: var(--bg-secondary);
            border-color: var(--accent-primary);
        }

        /* Save profile modal */
        .save-modal .modal {
            max-width: 380px;
        }

        .save-modal .modal-icon {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
        }

        .save-modal .form-group {
            text-align: left;
        }

        .save-modal input, .save-modal textarea {
            width: 100%;
            margin-top: 0.5rem;
        }

        .save-modal textarea {
            min-height: 80px;
            resize: vertical;
        }

        .modal-buttons {
            display: flex;
            gap: 0.75rem;
            margin-top: 1.5rem;
        }

        .modal-buttons .btn {
            flex: 1;
        }

        /* Toast notifications */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .toast {
            padding: 1rem 1.5rem;
            border-radius: 12px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            font-size: 0.9rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            animation: slideIn 0.3s ease;
            max-width: 350px;
        }

        .toast.success {
            border-color: var(--success);
            background: rgba(34, 197, 94, 0.1);
        }

        .toast.error {
            border-color: var(--error);
            background: rgba(239, 68, 68, 0.1);
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Checkbox */
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .checkbox-group input[type="checkbox"] {
            width: auto;
            accent-color: var(--accent-primary);
        }

        .checkbox-group label {
            margin: 0;
            cursor: pointer;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 0.5rem;
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
        }

        .tab {
            padding: 0.5rem 1rem;
            background: transparent;
            border: none;
            color: var(--text-muted);
            font-family: 'Outfit', sans-serif;
            font-size: 0.9rem;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.2s ease;
        }

        .tab:hover {
            color: var(--text-secondary);
            background: var(--bg-tertiary);
        }

        .tab.active {
            color: var(--accent-secondary);
            background: rgba(99, 102, 241, 0.1);
        }

        /* ============================================
           RECORD MODE STYLES
           ============================================ */
        .mode-switcher {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            padding: 0.25rem;
            background: var(--bg-tertiary);
            border-radius: 12px;
        }

        .mode-btn {
            flex: 1;
            padding: 0.75rem 1rem;
            background: transparent;
            border: none;
            color: var(--text-muted);
            font-family: 'Outfit', sans-serif;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            border-radius: 10px;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .mode-btn:hover {
            color: var(--text-secondary);
        }

        .mode-btn.active {
            background: var(--accent-primary);
            color: white;
            box-shadow: 0 4px 15px var(--accent-glow);
        }

        .mode-content {
            display: none;
        }

        .mode-content.active {
            display: block;
        }

        /* Record Mode specific */
        .record-status {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 1rem;
            background: var(--bg-tertiary);
            border-radius: 10px;
            margin-bottom: 1rem;
        }

        .record-status.recording {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .record-status.recording .pulse {
            width: 12px;
            height: 12px;
            background: var(--error);
            border-radius: 50%;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(1.2); }
        }

        .record-counter {
            font-family: 'JetBrains Mono', monospace;
            font-size: 2rem;
            font-weight: 600;
            color: var(--accent-secondary);
            text-align: center;
            margin: 1.5rem 0;
        }

        .record-counter small {
            display: block;
            font-size: 0.8rem;
            font-weight: 400;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        /* Recorded endpoints list */
        .recorded-endpoint {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: var(--bg-tertiary);
            border-radius: 10px;
            margin-bottom: 0.75rem;
            border-left: 3px solid var(--border-color);
            transition: all 0.2s ease;
        }

        .recorded-endpoint.new {
            animation: slideInLeft 0.3s ease;
            border-left-color: var(--accent-primary);
            background: rgba(99, 102, 241, 0.1);
        }

        .recorded-endpoint.confirmed {
            border-left-color: var(--success);
        }

        .recorded-endpoint.skipped {
            opacity: 0.5;
            border-left-color: var(--text-muted);
        }

        @keyframes slideInLeft {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .recorded-endpoint-info {
            flex: 1;
            min-width: 0;
        }

        .recorded-endpoint-path {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            color: var(--text-primary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .recorded-endpoint-name {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-top: 0.25rem;
        }

        .recorded-endpoint-name.custom {
            color: var(--success);
        }

        .recorded-endpoint-actions {
            display: flex;
            gap: 0.5rem;
        }

        .recorded-endpoint-actions button {
            padding: 0.4rem 0.6rem;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--text-secondary);
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .recorded-endpoint-actions button:hover {
            background: var(--bg-primary);
            color: var(--text-primary);
        }

        .recorded-endpoint-actions button.skip:hover {
            border-color: var(--error);
            color: var(--error);
        }

        /* Edit endpoint modal */
        .edit-endpoint-modal .modal {
            max-width: 500px;
        }

        .edit-endpoint-modal .endpoint-preview {
            background: var(--bg-tertiary);
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .edit-endpoint-modal .endpoint-preview .endpoint-method {
            display: inline-block;
            padding: 0.35rem 0.6rem;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 600;
            min-width: 50px;
            text-align: center;
        }

        .edit-endpoint-modal .endpoint-preview #editEndpointPath {
            flex: 1;
            word-break: break-all;
        }

        /* Record mode button variants */
        .btn-record {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
            box-shadow: 0 4px 20px rgba(239, 68, 68, 0.3);
        }

        .btn-record:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(239, 68, 68, 0.4);
        }

        .btn-record.recording {
            animation: recordPulse 2s infinite;
        }

        @keyframes recordPulse {
            0%, 100% { box-shadow: 0 4px 20px rgba(239, 68, 68, 0.3); }
            50% { box-shadow: 0 4px 30px rgba(239, 68, 68, 0.6); }
        }
    </style>
</head>
<body>
    <div class="bg-grid"></div>
    <div class="bg-glow bg-glow-1"></div>
    <div class="bg-glow bg-glow-2"></div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Snapshot Modal (Lightbox) -->
    <div class="snapshot-modal" id="snapshotModal" onclick="closeSnapshotModal()">
        <button class="close-btn" onclick="closeSnapshotModal()">√ó</button>
        <img src="" alt="Snapshot">
        <div class="snapshot-details"></div>
    </div>

    <!-- Save Profile Modal -->
    <div class="modal-overlay save-modal" id="saveProfileModal">
        <div class="modal">
            <div class="modal-icon">üíæ</div>
            <h2>Save Profile</h2>
            <p>Save this configuration for quick access later</p>
            <div class="form-group">
                <label for="profileName">Profile Name</label>
                <input type="text" id="profileName" placeholder="e.g., my-app-staging">
            </div>
            <div class="form-group">
                <label for="profileDescription">Description (optional)</label>
                <textarea id="profileDescription" placeholder="e.g., Staging environment with test credentials"></textarea>
            </div>
            <div class="modal-buttons">
                <button class="btn btn-secondary" onclick="hideSaveProfileModal()">Cancel</button>
                <button class="btn btn-primary" onclick="saveCurrentProfile()">üíæ Save</button>
            </div>
        </div>
    </div>

    <!-- 2FA Modal -->
    <div class="modal-overlay" id="twoFaModal">
        <div class="modal">
            <div class="modal-icon">üîê</div>
            <h2>Two-Factor Authentication</h2>
            <p>Enter the verification code from your authenticator app, SMS, or email</p>
            <div class="code-input-group">
                <input type="text" class="code-input" maxlength="1" data-index="0" inputmode="numeric">
                <input type="text" class="code-input" maxlength="1" data-index="1" inputmode="numeric">
                <input type="text" class="code-input" maxlength="1" data-index="2" inputmode="numeric">
                <input type="text" class="code-input" maxlength="1" data-index="3" inputmode="numeric">
                <input type="text" class="code-input" maxlength="1" data-index="4" inputmode="numeric">
                <input type="text" class="code-input" maxlength="1" data-index="5" inputmode="numeric">
            </div>
            <button class="btn btn-primary btn-full" id="submit2fa" onclick="submit2FACode()">
                ‚úì Verify Code
            </button>
            <div class="modal-timer">
                Time remaining: <span id="twoFaTimer">5:00</span>
            </div>
        </div>
    </div>

    <!-- Edit Endpoint Modal (Record Mode) -->
    <div class="modal-overlay edit-endpoint-modal" id="editEndpointModal">
        <div class="modal">
            <div class="modal-icon">‚úèÔ∏è</div>
            <h2>Edit Endpoint</h2>
            <div class="endpoint-preview" id="endpointPreview">
                <span class="endpoint-method method-GET" id="editEndpointMethod">GET</span>
                <span id="editEndpointPath">/api/example</span>
            </div>
            <div class="form-group">
                <label for="editEndpointName">Name</label>
                <input type="text" id="editEndpointName" placeholder="e.g., Get User Details" onkeydown="handleEditKeydown(event)">
            </div>
            <div class="form-group">
                <label for="editEndpointDescription">Description</label>
                <textarea id="editEndpointDescription" placeholder="What does this endpoint do?" onkeydown="handleEditKeydown(event)"></textarea>
            </div>
            <input type="hidden" id="editEndpointId">
            <div class="modal-buttons">
                <button class="btn btn-secondary" onclick="closeEditEndpointModal()">Cancel</button>
                <button class="btn btn-danger" onclick="skipEndpoint()">üö´ Skip</button>
                <button class="btn btn-primary" onclick="confirmEndpoint()">‚úì Confirm</button>
            </div>
        </div>
    </div>

    <div class="container">
        <header>
            <div class="logo">
                <div class="logo-icon">üîç</div>
                <div>
                    <h1>API Endpoint Hunter</h1>
                    <p class="tagline">Discover and document APIs automatically</p>
                </div>
            </div>
        </header>

        <div class="main-grid">
            <!-- Left Panel - Configuration -->
            <div class="card">
                <div class="card-header">
                    <span class="card-header-icon">‚öôÔ∏è</span>
                    <h2>Configuration</h2>
                </div>
                <div class="card-body">
                    <!-- Mode Switcher -->
                    <div class="mode-switcher">
                        <button class="mode-btn active" onclick="switchMode('crawl')" id="crawlModeBtn">
                            üï∑Ô∏è Auto Crawl
                        </button>
                        <button class="mode-btn" onclick="switchMode('record')" id="recordModeBtn">
                            üî¥ Record Mode
                        </button>
                    </div>

                    <!-- ========== CRAWL MODE ========== -->
                    <div class="mode-content active" id="crawlModeContent">
                        <!-- Profile selector -->
                        <div class="profile-bar">
                            <select id="profileSelect" onchange="loadProfile()">
                                <option value="">‚Äî Select a saved profile ‚Äî</option>
                            </select>
                            <button type="button" class="btn-icon" onclick="showSaveProfileModal()" title="Save current config">
                                üíæ
                            </button>
                            <button type="button" class="btn-icon" onclick="deleteCurrentProfile()" title="Delete selected profile" id="deleteProfileBtn" style="display: none;">
                                üóëÔ∏è
                            </button>
                        </div>

                        <form id="crawlForm">
                        <div class="form-group">
                            <label for="url">Target URL</label>
                            <input type="url" id="url" name="url" placeholder="https://example.com" required>
                        </div>

                        <!-- Authentication -->
                        <div class="collapsible" id="authSection">
                            <div class="collapsible-header" onclick="toggleCollapsible('authSection')">
                                <h3>üîê Authentication</h3>
                                <span class="collapsible-arrow">‚ñº</span>
                            </div>
                            <div class="collapsible-content">
                                <div class="collapsible-inner">
                                    <div class="form-group">
                                        <label for="loginUrl">Login URL (optional)</label>
                                        <input type="url" id="loginUrl" name="loginUrl" placeholder="https://example.com/login">
                                    </div>
                                    <div class="form-group">
                                        <label for="username">Username</label>
                                        <input type="text" id="username" name="username" placeholder="user@example.com">
                                    </div>
                                    <div class="form-group">
                                        <label for="password">Password</label>
                                        <input type="password" id="password" name="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                                    </div>
                                    <div class="form-group">
                                        <label for="authHeader">Auth Header (optional)</label>
                                        <input type="text" id="authHeader" name="authHeader" placeholder="Authorization: Bearer token...">
                                    </div>
                                    <div class="form-group">
                                        <label for="cookies">Cookies (optional)</label>
                                        <input type="text" id="cookies" name="cookies" placeholder="session=abc123; token=xyz">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Crawl Options -->
                        <div class="collapsible" id="optionsSection">
                            <div class="collapsible-header" onclick="toggleCollapsible('optionsSection')">
                                <h3>üï∑Ô∏è Crawl Options</h3>
                                <span class="collapsible-arrow">‚ñº</span>
                            </div>
                            <div class="collapsible-content">
                                <div class="collapsible-inner">
                                    <div class="form-group">
                                        <label for="maxPages">Max Pages</label>
                                        <input type="number" id="maxPages" name="maxPages" value="50" min="1" max="500">
                                    </div>
                                    <div class="form-group">
                                        <label for="maxDepth">Max Depth</label>
                                        <input type="number" id="maxDepth" name="maxDepth" value="3" min="1" max="10">
                                    </div>
                                    <div class="form-group">
                                        <label for="waitTime">Wait Time (ms)</label>
                                        <input type="number" id="waitTime" name="waitTime" value="2000" min="500" max="10000">
                                    </div>
                                    <div class="form-group">
                                        <div class="checkbox-group">
                                            <input type="checkbox" id="headless" name="headless" checked>
                                            <label for="headless">Headless Mode (hide browser)</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <button type="submit" class="btn btn-primary btn-full" id="startBtn">
                            <span>üöÄ</span> Start Crawl
                        </button>
                    </form>

                    <!-- Progress Section -->
                    <div class="progress-section" id="progressSection" style="display: none;">
                        <div id="statusMessage" class="status-message">
                            <span class="loading">‚è≥</span>
                            <span>Initializing...</span>
                        </div>

                        <div class="progress-bar-container">
                            <div class="progress-bar" id="progressBar"></div>
                        </div>

                        <div class="progress-stats">
                            <div class="stat">
                                <div class="stat-value" id="pagesVisited">0</div>
                                <div class="stat-label">Pages</div>
                            </div>
                            <div class="stat">
                                <div class="stat-value" id="apisCaptured">0</div>
                                <div class="stat-label">APIs</div>
                            </div>
                            <div class="stat">
                                <div class="stat-value" id="duration">0s</div>
                                <div class="stat-label">Time</div>
                            </div>
                        </div>

                        <button type="button" class="btn btn-danger btn-full" id="stopBtn" style="margin-top: 1rem;">
                            ‚èπÔ∏è Stop Crawl
                        </button>
                    </div>
                    </div><!-- End crawlModeContent -->

                    <!-- ========== RECORD MODE ========== -->
                    <div class="mode-content" id="recordModeContent">
                        <!-- Profile Selector for Record Mode -->
                        <div class="profile-selector">
                            <select id="recordProfileSelect" onchange="loadRecordProfile(this.value)">
                                <option value="">‚Äî Select a saved profile ‚Äî</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="recordUrl">Start URL</label>
                            <input type="url" id="recordUrl" placeholder="https://example.com" required>
                        </div>

                        <!-- Authentication (Record Mode) -->
                        <div class="collapsible" id="recordAuthSection">
                            <div class="collapsible-header" onclick="toggleCollapsible('recordAuthSection')">
                                <h3>üîê Authentication</h3>
                                <span class="collapsible-arrow">‚ñº</span>
                            </div>
                            <div class="collapsible-content">
                                <div class="collapsible-inner">
                                    <div class="form-group">
                                        <label for="recordLoginUrl">Login URL (optional)</label>
                                        <input type="url" id="recordLoginUrl" placeholder="https://example.com/login">
                                    </div>
                                    <div class="form-group">
                                        <label for="recordUsername">Username</label>
                                        <input type="text" id="recordUsername" placeholder="user@example.com">
                                    </div>
                                    <div class="form-group">
                                        <label for="recordPassword">Password</label>
                                        <input type="password" id="recordPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <button type="button" class="btn btn-record btn-full" id="startRecordBtn" onclick="startRecording()">
                            üî¥ Start Recording
                        </button>

                        <!-- Record Status -->
                        <div id="recordStatusSection" style="display: none;">
                            <div class="record-status recording">
                                <div class="pulse"></div>
                                <span id="recordStatusText">Recording... Click around in the browser!</span>
                            </div>

                            <div class="record-counter">
                                <span id="recordedCount">0</span>
                                <small>Endpoints Captured</small>
                            </div>

                            <button type="button" class="btn btn-danger btn-full" onclick="stopRecording()">
                                ‚èπÔ∏è Stop Recording
                            </button>

                            <button type="button" class="btn btn-secondary btn-full" onclick="exportRecorded()" style="margin-top: 0.5rem;">
                                üìÑ Export Documentation
                            </button>
                        </div>
                    </div><!-- End recordModeContent -->
                </div>
            </div>

            <!-- Right Panel - Results -->
            <div class="card endpoints-panel">
                <div class="tabs">
                    <button class="tab active" onclick="switchTab('endpoints')">üì° Endpoints</button>
                    <button class="tab" onclick="switchTab('recorded')">üî¥ Recorded</button>
                    <button class="tab" onclick="switchTab('log')">üìã Live Log</button>
                    <button class="tab" onclick="switchTab('snapshots')">üì∏ Snapshots</button>
                </div>

                <div id="endpointsTab" class="endpoints-list">
                    <div class="empty-state" id="emptyState">
                        <div class="empty-state-icon">üîç</div>
                        <p>No endpoints discovered yet.<br>Start a crawl to find API endpoints.</p>
                    </div>
                    <div id="endpointsList"></div>
                </div>

                <div id="recordedTab" class="endpoints-list" style="display: none;">
                    <div class="empty-state" id="recordedEmptyState">
                        <div class="empty-state-icon">üî¥</div>
                        <p>No endpoints recorded yet.<br>Start Record Mode and click around to capture APIs.</p>
                    </div>
                    <div id="recordedEndpointsList"></div>
                </div>

                <div id="logTab" class="endpoints-list" style="display: none;">
                    <div class="live-log" id="liveLog">
                        <div class="log-entry"><span class="time">[--:--:--]</span> Waiting for crawl to start...</div>
                    </div>
                </div>

                <div id="snapshotsTab" class="endpoints-list" style="display: none;">
                    <div class="snapshots-gallery" id="snapshotsGallery">
                        <div class="empty-state" id="snapshotsEmptyState">
                            <div class="empty-state-icon">üì∏</div>
                            <p>No snapshots yet.<br>Snapshots will appear here during crawl.</p>
                        </div>
                    </div>
                </div>

                <div class="download-buttons" id="downloadButtons" style="display: none;">
                    <div class="btn-group">
                        <button class="btn btn-secondary" onclick="downloadFile('openapi')" title="Download">
                            ‚¨áÔ∏è OpenAPI Spec
                        </button>
                        <button class="btn btn-outline" onclick="viewFile('openapi')" title="View in browser">
                            üëÅÔ∏è
                        </button>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-secondary" onclick="downloadFile('markdown')" title="Download">
                            ‚¨áÔ∏è Markdown Docs
                        </button>
                        <button class="btn btn-outline" onclick="viewFile('markdown')" title="View in browser">
                            üëÅÔ∏è
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Toast notification function (replaces alert)
        function showToast(message, type = 'info') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            container.appendChild(toast);
            
            // Auto-remove after 4 seconds
            setTimeout(() => {
                toast.style.animation = 'slideIn 0.3s ease reverse';
                setTimeout(() => toast.remove(), 300);
            }, 4000);
        }

        // WebSocket connection
        let ws = null;
        let startTime = null;
        let timerInterval = null;

        function connectWebSocket() {
            const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
            ws = new WebSocket(`${protocol}//${window.location.host}/ws`);

            ws.onopen = () => {
                console.log('WebSocket connected');
            };

            ws.onmessage = (event) => {
                console.log('WebSocket message:', event.data);
                const data = JSON.parse(event.data);
                handleMessage(data);
            };

            ws.onerror = (error) => {
                console.error('WebSocket error:', error);
            };

            ws.onclose = () => {
                console.log('WebSocket closed, reconnecting...');
                setTimeout(connectWebSocket, 1000);
            };
        }

        function updateStatus(message) {
            const statusEl = document.getElementById('statusMessage');
            statusEl.innerHTML = `<span class="loading">‚è≥</span><span>${message}</span>`;
        }

        function addLog(message) {
            const log = document.getElementById('liveLog');
            const time = new Date().toLocaleTimeString();
            const entry = document.createElement('div');
            entry.className = 'log-entry animate-in';
            entry.innerHTML = `<span class="time">[${time}]</span> ${message}`;
            log.appendChild(entry);
            log.scrollTop = log.scrollHeight;
        }

        function truncateUrl(url) {
            return url.length > 50 ? url.substring(0, 50) + '...' : url;
        }

        function renderEndpoints(endpoints) {
            const list = document.getElementById('endpointsList');
            const empty = document.getElementById('emptyState');
            
            if (endpoints.length === 0) {
                empty.style.display = 'block';
                list.innerHTML = '';
                return;
            }

            empty.style.display = 'none';
            list.innerHTML = endpoints.map(ep => `
                <div class="endpoint-item animate-in">
                    <span class="endpoint-method method-${ep.method}">${ep.method}</span>
                    <span class="endpoint-path">${ep.path}</span>
                    <span class="endpoint-count">${ep.captured_count}x</span>
                </div>
            `).join('');
        }

        function handleComplete(data) {
            clearInterval(timerInterval);
            const statusEl = document.getElementById('statusMessage');
            statusEl.className = 'status-message success';
            statusEl.innerHTML = `<span>‚úÖ</span><span>Complete! Found ${data.endpoints_found} endpoints in ${data.duration.toFixed(1)}s</span>`;
            
            document.getElementById('progressBar').style.width = '100%';
            
            // Re-enable start button
            const startBtn = document.getElementById('startBtn');
            startBtn.disabled = false;
            startBtn.style.opacity = '1';
            startBtn.style.pointerEvents = 'auto';
            
            document.getElementById('stopBtn').style.display = 'none';
            document.getElementById('downloadButtons').style.display = 'flex';
            
            addLog(`‚úÖ Crawl complete! ${data.pages_visited} pages, ${data.endpoints_found} endpoints`);
        }

        function handleError(message) {
            clearInterval(timerInterval);
            const statusEl = document.getElementById('statusMessage');
            statusEl.className = 'status-message error';
            statusEl.innerHTML = `<span>‚ùå</span><span>Error: ${message}</span>`;
            
            // Re-enable start button
            const startBtn = document.getElementById('startBtn');
            startBtn.disabled = false;
            startBtn.style.opacity = '1';
            startBtn.style.pointerEvents = 'auto';
            
            document.getElementById('stopBtn').style.display = 'none';
            
            addLog(`‚ùå Error: ${message}`);
        }

        function handleStopped() {
            clearInterval(timerInterval);
            const statusEl = document.getElementById('statusMessage');
            statusEl.className = 'status-message';
            statusEl.innerHTML = `<span>‚èπÔ∏è</span><span>Crawl stopped</span>`;
            
            // Re-enable start button
            const startBtn = document.getElementById('startBtn');
            startBtn.disabled = false;
            startBtn.style.opacity = '1';
            startBtn.style.pointerEvents = 'auto';
            
            document.getElementById('stopBtn').style.display = 'none';
            
            addLog('‚èπÔ∏è Crawl stopped by user');
        }

        // Form submission
        document.getElementById('crawlForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            // Auto-add https:// to URL if just a domain was entered
            let url = document.getElementById('url').value.trim();
            if (url && !url.startsWith('http://') && !url.startsWith('https://')) {
                url = 'https://' + url;
                document.getElementById('url').value = url; // Update the field
            }
            
            // Auto-add https:// to login_url if provided
            let loginUrl = document.getElementById('loginUrl').value.trim() || null;
            if (loginUrl && !loginUrl.startsWith('http://') && !loginUrl.startsWith('https://')) {
                loginUrl = 'https://' + loginUrl;
                document.getElementById('loginUrl').value = loginUrl; // Update the field
            }
            
            const formData = {
                url: url,
                login_url: loginUrl,
                username: document.getElementById('username').value || null,
                password: document.getElementById('password').value || null,
                max_pages: parseInt(document.getElementById('maxPages').value),
                max_depth: parseInt(document.getElementById('maxDepth').value),
                wait_time: parseInt(document.getElementById('waitTime').value),
                headless: document.getElementById('headless').checked,
                auth_headers: {},
                cookies: {},
            };

            // Parse auth header
            const authHeader = document.getElementById('authHeader').value;
            if (authHeader && authHeader.includes(':')) {
                const [name, ...valueParts] = authHeader.split(':');
                formData.auth_headers[name.trim()] = valueParts.join(':').trim();
            }

            // Parse cookies
            const cookiesStr = document.getElementById('cookies').value;
            if (cookiesStr) {
                cookiesStr.split(';').forEach(cookie => {
                    const [name, value] = cookie.split('=');
                    if (name && value) {
                        formData.cookies[name.trim()] = value.trim();
                    }
                });
            }

            // Start crawl
            try {
                const response = await fetch('/api/crawl', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData),
                });

                const result = await response.json();

                if (response.ok) {
                    // Show progress section
                    const progressSection = document.getElementById('progressSection');
                    progressSection.style.display = 'block';
                    
                    // Disable start button and show stop button
                    const startBtn = document.getElementById('startBtn');
                    startBtn.disabled = true;
                    startBtn.style.opacity = '0.5';
                    startBtn.style.pointerEvents = 'none';
                    
                    document.getElementById('stopBtn').style.display = 'block';
                    document.getElementById('downloadButtons').style.display = 'none';
                    document.getElementById('emptyState').style.display = 'block';
                    document.getElementById('endpointsList').innerHTML = '';
                    document.getElementById('liveLog').innerHTML = '';
                    
                    // Clear previous snapshots
                    clearSnapshots();
                    
                    // Reset status message
                    const statusEl = document.getElementById('statusMessage');
                    statusEl.className = 'status-message';
                    statusEl.innerHTML = '<span class="loading">‚è≥</span><span>Initializing...</span>';
                    
                    // Reset stats
                    document.getElementById('pagesVisited').textContent = '0';
                    document.getElementById('apisCaptured').textContent = '0';
                    document.getElementById('progressBar').style.width = '0%';
                    document.getElementById('duration').textContent = '0s';
                    
                    // Start timer
                    startTime = Date.now();
                    timerInterval = setInterval(() => {
                        const elapsed = Math.floor((Date.now() - startTime) / 1000);
                        document.getElementById('duration').textContent = `${elapsed}s`;
                    }, 1000);
                    
                    addLog('üöÄ Starting crawl...');
                    
                    // Scroll to progress section
                    progressSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                } else {
                    showToast(result.error || 'Failed to start crawl', 'error');
                }
            } catch (err) {
                showToast('Failed to connect to server: ' + err.message, 'error');
            }
        });

        // Stop button
        document.getElementById('stopBtn').addEventListener('click', async () => {
            await fetch('/api/stop', { method: 'POST' });
        });

        // Collapsible sections
        function toggleCollapsible(id) {
            document.getElementById(id).classList.toggle('open');
        }

        // Tabs
        function switchTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelector(`.tab[onclick="switchTab('${tab}')"]`).classList.add('active');
            
            document.getElementById('endpointsTab').style.display = tab === 'endpoints' ? 'block' : 'none';
            document.getElementById('recordedTab').style.display = tab === 'recorded' ? 'block' : 'none';
            document.getElementById('logTab').style.display = tab === 'log' ? 'block' : 'none';
            document.getElementById('snapshotsTab').style.display = tab === 'snapshots' ? 'block' : 'none';
        }

        // ============================================
        // MODE SWITCHING
        // ============================================
        function switchMode(mode) {
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(mode + 'ModeBtn').classList.add('active');
            
            document.getElementById('crawlModeContent').classList.toggle('active', mode === 'crawl');
            document.getElementById('recordModeContent').classList.toggle('active', mode === 'record');
            
            // Switch to appropriate tab
            if (mode === 'record') {
                switchTab('recorded');
            } else {
                switchTab('endpoints');
            }
        }

        // ============================================
        // RECORD MODE
        // ============================================
        let isRecording = false;
        let recordedEndpoints = {};

        async function startRecording() {
            let url = document.getElementById('recordUrl').value.trim();
            
            if (!url) {
                showToast('Please enter a URL to start recording', 'error');
                document.getElementById('recordUrl').focus();
                return;
            }
            
            // Auto-add https:// if just a domain was entered
            if (!url.startsWith('http://') && !url.startsWith('https://')) {
                url = 'https://' + url;
                document.getElementById('recordUrl').value = url; // Update the field
            }
            
            // Auto-add https:// to login_url if provided
            let loginUrl = document.getElementById('recordLoginUrl').value.trim() || null;
            if (loginUrl && !loginUrl.startsWith('http://') && !loginUrl.startsWith('https://')) {
                loginUrl = 'https://' + loginUrl;
                document.getElementById('recordLoginUrl').value = loginUrl; // Update the field
            }
            
            // Disable button while starting
            const startBtn = document.getElementById('startRecordBtn');
            startBtn.disabled = true;
            startBtn.innerHTML = '‚è≥ Launching browser...';
            
            const data = {
                url: url,
                login_url: loginUrl,
                username: document.getElementById('recordUsername').value || null,
                password: document.getElementById('recordPassword').value || null,
            };
            
            try {
                const response = await fetch('/api/record/start', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data),
                });
                
                if (response.ok) {
                    isRecording = true;
                    recordedEndpoints = {};
                    
                    // Update UI
                    startBtn.style.display = 'none';
                    startBtn.disabled = false;
                    startBtn.innerHTML = 'üî¥ Start Recording';
                    document.getElementById('recordStatusSection').style.display = 'block';
                    document.getElementById('recordedCount').textContent = '0';
                    document.getElementById('recordedEndpointsList').innerHTML = '';
                    document.getElementById('recordedEmptyState').style.display = 'block';
                    
                    // Switch to recorded tab
                    switchTab('recorded');
                    
                    addLog('üî¥ Recording started - browser launched');
                    showToast('Recording started! Click around in the browser window.', 'success');
                } else {
                    const error = await response.json();
                    startBtn.disabled = false;
                    startBtn.innerHTML = 'üî¥ Start Recording';
                    showToast(error.error || 'Failed to start recording', 'error');
                    addLog('‚ùå Failed to start recording: ' + (error.error || 'Unknown error'));
                }
            } catch (err) {
                startBtn.disabled = false;
                startBtn.innerHTML = 'üî¥ Start Recording';
                showToast('Failed to connect to server: ' + err.message, 'error');
                addLog('‚ùå Connection error: ' + err.message);
            }
        }

        async function stopRecording() {
            const stopBtn = document.querySelector('#recordStatusSection button');
            if (stopBtn) {
                stopBtn.disabled = true;
                stopBtn.innerHTML = '‚è≥ Stopping...';
            }
            
            try {
                await fetch('/api/record/stop', { method: 'POST' });
                
                isRecording = false;
                
                // Update UI
                document.getElementById('startRecordBtn').style.display = 'block';
                document.getElementById('recordStatusSection').style.display = 'none';
                
                // Show export button if we have endpoints
                const count = Object.keys(recordedEndpoints).length;
                if (count > 0) {
                    showToast(`Recording stopped. ${count} endpoints captured. Click "Export Documentation" to generate docs.`, 'success');
                } else {
                    showToast('Recording stopped. No endpoints were captured.', 'info');
                }
                
                addLog(`‚èπÔ∏è Recording stopped - ${count} endpoints captured`);
            } catch (err) {
                showToast('Failed to stop recording: ' + err.message, 'error');
            } finally {
                if (stopBtn) {
                    stopBtn.disabled = false;
                    stopBtn.innerHTML = '‚èπÔ∏è Stop Recording';
                }
            }
        }

        async function exportRecorded() {
            try {
                // First, refresh endpoints from backend to ensure sync
                addLog('üîÑ Syncing with backend...');
                const syncResponse = await fetch('/api/record/endpoints');
                if (syncResponse.ok) {
                    const syncData = await syncResponse.json();
                    console.log(`[Export] Backend has ${syncData.count} endpoints`);
                    
                    // Update local recordedEndpoints with backend data
                    syncData.endpoints.forEach(ep => {
                        recordedEndpoints[ep.id] = ep;
                    });
                    renderRecordedEndpoints();
                    addLog(`‚úÖ Synced: ${syncData.count} endpoints from backend`);
                }
                
                // Now export
                addLog('üìÑ Exporting documentation...');
                const response = await fetch('/api/record/export', { method: 'POST' });
                const data = await response.json();
                
                if (response.ok) {
                    addLog(`üìÑ Exported ${data.endpoints_count} endpoints`);
                    showToast(`Documentation exported for ${data.endpoints_count} endpoints!`, 'success');
                    
                    // Show download buttons
                    document.getElementById('downloadButtons').style.display = 'flex';
                } else {
                    showToast(data.error || 'Failed to export', 'error');
                    addLog(`‚ùå Export failed: ${data.error || 'Unknown error'}`);
                }
            } catch (err) {
                showToast('Failed to export: ' + err.message, 'error');
                addLog(`‚ùå Export error: ${err.message}`);
            }
        }

        function addRecordedEndpoint(endpoint) {
            recordedEndpoints[endpoint.id] = endpoint;
            renderRecordedEndpoints();
            
            // Update counter
            document.getElementById('recordedCount').textContent = Object.keys(recordedEndpoints).length;
            
            // Show edit modal for new endpoints
            showEditEndpointModal(endpoint);
        }

        function renderRecordedEndpoints() {
            const list = document.getElementById('recordedEndpointsList');
            const emptyState = document.getElementById('recordedEmptyState');
            const endpoints = Object.values(recordedEndpoints);
            
            if (endpoints.length === 0) {
                emptyState.style.display = 'block';
                list.innerHTML = '';
                return;
            }
            
            emptyState.style.display = 'none';
            
            list.innerHTML = endpoints.map(ep => {
                const statusClass = ep.skipped ? 'skipped' : (ep.confirmed ? 'confirmed' : 'new');
                const nameClass = ep.name ? 'custom' : '';
                const displayName = ep.name || ep.auto_name || 'Unnamed endpoint';
                
                return `
                    <div class="recorded-endpoint ${statusClass}">
                        <span class="endpoint-method method-${ep.method}">${ep.method}</span>
                        <div class="recorded-endpoint-info">
                            <div class="recorded-endpoint-path">${ep.path}</div>
                            <div class="recorded-endpoint-name ${nameClass}">${displayName}</div>
                        </div>
                        <div class="recorded-endpoint-actions">
                            <button onclick="showEditEndpointModal(recordedEndpoints['${ep.id}'])">‚úèÔ∏è Edit</button>
                            <button class="skip" onclick="toggleSkipEndpoint('${ep.id}')">${ep.skipped ? '‚Ü©Ô∏è Restore' : 'üö´ Skip'}</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function showEditEndpointModal(endpoint) {
            const modal = document.getElementById('editEndpointModal');
            const methodEl = document.getElementById('editEndpointMethod');
            
            methodEl.textContent = endpoint.method;
            methodEl.className = `endpoint-method method-${endpoint.method}`;
            
            document.getElementById('editEndpointPath').textContent = endpoint.path;
            document.getElementById('editEndpointName').value = endpoint.name || endpoint.auto_name || '';
            document.getElementById('editEndpointDescription').value = endpoint.description || endpoint.auto_description || '';
            document.getElementById('editEndpointId').value = endpoint.id;
            
            modal.classList.add('active');
            
            // Focus and select the name field for quick editing
            const nameInput = document.getElementById('editEndpointName');
            nameInput.focus();
            nameInput.select();
        }

        function closeEditEndpointModal() {
            document.getElementById('editEndpointModal').classList.remove('active');
        }

        // Keyboard shortcuts for edit modal
        function handleEditKeydown(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                confirmEndpoint();
            } else if (event.key === 'Escape') {
                closeEditEndpointModal();
            }
        }

        // Global keyboard listener for edit modal
        document.addEventListener('keydown', (event) => {
            const modal = document.getElementById('editEndpointModal');
            if (!modal.classList.contains('active')) return;
            
            if (event.key === 'Escape') {
                closeEditEndpointModal();
            }
        });

        async function confirmEndpoint() {
            const id = document.getElementById('editEndpointId').value;
            const name = document.getElementById('editEndpointName').value.trim();
            const description = document.getElementById('editEndpointDescription').value.trim();
            
            try {
                const response = await fetch('/api/record/endpoint/edit', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        endpoint_id: id,
                        name: name || null,
                        description: description || null,
                        skip: false,
                    }),
                });
                
                if (response.ok) {
                    const data = await response.json();
                    recordedEndpoints[id] = data.endpoint;
                    renderRecordedEndpoints();
                    closeEditEndpointModal();
                    showToast('Endpoint confirmed!', 'success');
                }
            } catch (err) {
                showToast('Failed to update endpoint', 'error');
            }
        }

        async function skipEndpoint() {
            const id = document.getElementById('editEndpointId').value;
            
            try {
                const response = await fetch('/api/record/endpoint/edit', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        endpoint_id: id,
                        skip: true,
                    }),
                });
                
                if (response.ok) {
                    const data = await response.json();
                    recordedEndpoints[id] = data.endpoint;
                    renderRecordedEndpoints();
                    closeEditEndpointModal();
                    showToast('Endpoint skipped', 'info');
                }
            } catch (err) {
                showToast('Failed to skip endpoint', 'error');
            }
        }

        async function toggleSkipEndpoint(id) {
            const endpoint = recordedEndpoints[id];
            if (!endpoint) return;
            
            try {
                const response = await fetch('/api/record/endpoint/edit', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        endpoint_id: id,
                        skip: !endpoint.skipped,
                    }),
                });
                
                if (response.ok) {
                    const data = await response.json();
                    recordedEndpoints[id] = data.endpoint;
                    renderRecordedEndpoints();
                }
            } catch (err) {
                showToast('Failed to update endpoint', 'error');
            }
        }

        // Download files
        function downloadFile(type) {
            const url = type === 'openapi' ? '/api/docs/openapi?download=1' : '/api/docs/markdown?download=1';
            const filename = type === 'openapi' ? 'openapi.yaml' : 'api-docs.md';
            
            fetch(url)
                .then(response => response.blob())
                .then(blob => {
                    const link = document.createElement('a');
                    link.href = URL.createObjectURL(blob);
                    link.download = filename;
                    link.click();
                    URL.revokeObjectURL(link.href);
                })
                .catch(err => showToast('Failed to download: ' + err.message, 'error'));
        }
        
        // View files in new tab
        function viewFile(type) {
            const url = type === 'openapi' ? '/api/docs/openapi' : '/api/docs/markdown';
            window.open(url, '_blank');
        }

        // Snapshots handling
        let snapshots = [];

        function addSnapshot(data) {
            snapshots.push(data);
            renderSnapshots();
            // Auto-switch to snapshots tab on first snapshot
            if (snapshots.length === 1) {
                switchTab('snapshots');
            }
        }

        function renderSnapshots() {
            const gallery = document.getElementById('snapshotsGallery');
            const emptyState = document.getElementById('snapshotsEmptyState');
            
            if (snapshots.length === 0) {
                emptyState.style.display = 'block';
                return;
            }
            
            emptyState.style.display = 'none';
            
            // Clear and re-render
            gallery.innerHTML = '';
            
            snapshots.forEach((snap, index) => {
                const item = document.createElement('div');
                item.className = 'snapshot-item';
                item.onclick = () => openSnapshotModal(snap);
                item.innerHTML = `
                    <img src="/api/snapshots/${snap.filename}" alt="Page ${snap.page_num}" loading="lazy">
                    <div class="snapshot-info">
                        <span class="page-num">Page ${snap.page_num}</span>
                        <span class="url" title="${snap.url}">${truncateUrl(snap.url)}</span>
                    </div>
                `;
                gallery.appendChild(item);
            });
        }

        function openSnapshotModal(snap) {
            const modal = document.getElementById('snapshotModal');
            const img = modal.querySelector('img');
            const details = modal.querySelector('.snapshot-details');
            
            img.src = `/api/snapshots/${snap.filename}`;
            details.innerHTML = `<strong>Page ${snap.page_num}</strong><br>${snap.url}`;
            
            modal.classList.add('active');
        }

        function closeSnapshotModal() {
            document.getElementById('snapshotModal').classList.remove('active');
        }

        function clearSnapshots() {
            snapshots = [];
            renderSnapshots();
        }

        // 2FA Modal handling
        let twoFaTimerInterval = null;

        function show2FAModal() {
            const modal = document.getElementById('twoFaModal');
            modal.classList.add('active');
            
            // Clear inputs
            document.querySelectorAll('.code-input').forEach(input => {
                input.value = '';
            });
            
            // Focus first input
            document.querySelector('.code-input[data-index="0"]').focus();
            
            // Start countdown (5 minutes)
            let remaining = 300;
            document.getElementById('twoFaTimer').textContent = '5:00';
            
            twoFaTimerInterval = setInterval(() => {
                remaining--;
                const mins = Math.floor(remaining / 60);
                const secs = remaining % 60;
                document.getElementById('twoFaTimer').textContent = 
                    `${mins}:${secs.toString().padStart(2, '0')}`;
                
                if (remaining <= 0) {
                    clearInterval(twoFaTimerInterval);
                    hide2FAModal();
                }
            }, 1000);
            
            addLog('üîê 2FA required - enter your verification code');
        }

        function hide2FAModal() {
            const modal = document.getElementById('twoFaModal');
            modal.classList.remove('active');
            if (twoFaTimerInterval) {
                clearInterval(twoFaTimerInterval);
            }
        }

        async function submit2FACode() {
            const inputs = document.querySelectorAll('.code-input');
            let code = '';
            inputs.forEach(input => code += input.value);
            
            if (code.length !== 6) {
                showToast('Please enter all 6 digits', 'error');
                return;
            }
            
            try {
                const response = await fetch('/api/2fa', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ code }),
                });
                
                if (response.ok) {
                    hide2FAModal();
                    addLog('‚úì 2FA code submitted');
                } else {
                    const error = await response.json();
                    showToast(error.error || 'Failed to submit code', 'error');
                }
            } catch (err) {
                showToast('Failed to submit code', 'error');
            }
        }

        // Code input handling - auto-advance and paste support
        document.querySelectorAll('.code-input').forEach((input, index) => {
            input.addEventListener('input', (e) => {
                const value = e.target.value;
                if (value && index < 5) {
                    document.querySelector(`.code-input[data-index="${index + 1}"]`).focus();
                }
                
                // Auto-submit when all filled
                const allInputs = document.querySelectorAll('.code-input');
                let fullCode = '';
                allInputs.forEach(inp => fullCode += inp.value);
                if (fullCode.length === 6) {
                    submit2FACode();
                }
            });
            
            input.addEventListener('keydown', (e) => {
                if (e.key === 'Backspace' && !e.target.value && index > 0) {
                    document.querySelector(`.code-input[data-index="${index - 1}"]`).focus();
                }
            });
            
            input.addEventListener('paste', (e) => {
                e.preventDefault();
                const pasteData = e.clipboardData.getData('text').replace(/\D/g, '').slice(0, 6);
                document.querySelectorAll('.code-input').forEach((inp, i) => {
                    inp.value = pasteData[i] || '';
                });
                if (pasteData.length === 6) {
                    submit2FACode();
                }
            });
        });

        // Handle WebSocket messages
        function handleMessage(data) {
            switch (data.type) {
                case 'ping':
                    // Keep-alive ping from server, no action needed
                    break;
                case 'status':
                    updateStatus(data.message);
                    addLog(data.message);
                    break;
                case 'page':
                    document.getElementById('pagesVisited').textContent = data.visited;
                    const progress = (data.visited / data.max_pages) * 100;
                    document.getElementById('progressBar').style.width = `${progress}%`;
                    addLog(`üìÑ Crawling: ${truncateUrl(data.url)} (depth: ${data.depth}/${document.getElementById('maxDepth').value})`);
                    break;
                case 'captured':
                    document.getElementById('apisCaptured').textContent = data.count;
                    break;
                case 'endpoints':
                    renderEndpoints(data.data);
                    break;
                case 'snapshot':
                    addSnapshot(data);
                    addLog(`üì∏ Snapshot: Page ${data.page_num}`);
                    break;
                case 'complete':
                    handleComplete(data);
                    break;
                case 'error':
                    handleError(data.message);
                    break;
                case 'stopped':
                    handleStopped();
                    break;
                case '2fa_required':
                    show2FAModal();
                    break;
                
                // Record Mode events
                case 'record_status':
                    document.getElementById('recordStatusText').textContent = data.message;
                    addLog(data.message);
                    break;
                case 'record_ready':
                    document.getElementById('recordStatusText').textContent = data.message;
                    addLog(data.message);
                    break;
                case 'record_new_endpoint':
                    addRecordedEndpoint(data.endpoint);
                    addLog(`üî¥ Captured: ${data.endpoint.method} ${data.endpoint.path}`);
                    break;
                case 'record_endpoint_updated':
                    recordedEndpoints[data.endpoint.id] = data.endpoint;
                    renderRecordedEndpoints();
                    break;
                case 'record_heartbeat':
                    document.getElementById('recordedCount').textContent = data.endpoints_count;
                    break;
                case 'record_stopped':
                    isRecording = false;
                    document.getElementById('startRecordBtn').style.display = 'block';
                    document.getElementById('recordStatusSection').style.display = 'none';
                    break;
                case 'record_error':
                    showToast('Recording error: ' + data.message, 'error');
                    addLog('‚ùå Recording error: ' + data.message);
                    break;
                case 'record_export_complete':
                    document.getElementById('downloadButtons').style.display = 'flex';
                    break;
            }
        }

        // Profile management
        let currentProfileName = null;

        async function loadProfiles() {
            try {
                const response = await fetch('/api/profiles');
                const data = await response.json();
                
                // Get both selects
                const crawlSelect = document.getElementById('profileSelect');
                const recordSelect = document.getElementById('recordProfileSelect');
                
                // Clear existing options except the first
                const defaultOption = '<option value="">‚Äî Select a saved profile ‚Äî</option>';
                crawlSelect.innerHTML = defaultOption;
                recordSelect.innerHTML = defaultOption;
                
                // Add profiles to both dropdowns
                const profiles = data.profiles || [];
                profiles.forEach(profile => {
                    const optText = profile.name + (profile.description ? ` - ${profile.description}` : '');
                    
                    // Add to Auto Crawl dropdown
                    const crawlOpt = document.createElement('option');
                    crawlOpt.value = profile.name;
                    crawlOpt.textContent = optText;
                    crawlSelect.appendChild(crawlOpt);
                    
                    // Add to Record Mode dropdown
                    const recordOpt = document.createElement('option');
                    recordOpt.value = profile.name;
                    recordOpt.textContent = optText;
                    recordSelect.appendChild(recordOpt);
                });
            } catch (err) {
                console.error('Failed to load profiles:', err);
            }
        }

        async function loadProfile() {
            const select = document.getElementById('profileSelect');
            const name = select.value;
            
            if (!name) {
                currentProfileName = null;
                document.getElementById('deleteProfileBtn').style.display = 'none';
                return;
            }
            
            try {
                const response = await fetch(`/api/profiles/${encodeURIComponent(name)}`);
                const data = await response.json();
                
                if (data.config) {
                    // Fill form with profile data
                    document.getElementById('url').value = data.config.url || '';
                    document.getElementById('loginUrl').value = data.config.login_url || '';
                    document.getElementById('username').value = data.config.username || '';
                    document.getElementById('password').value = data.config.password || '';
                    document.getElementById('maxPages').value = data.config.max_pages || 50;
                    document.getElementById('maxDepth').value = data.config.max_depth || 3;
                    document.getElementById('waitTime').value = data.config.wait_time || 2000;
                    document.getElementById('headless').checked = data.config.headless !== false;
                    
                    // Handle auth headers
                    if (data.config.auth_headers && Object.keys(data.config.auth_headers).length > 0) {
                        const headers = Object.entries(data.config.auth_headers)
                            .map(([k, v]) => `${k}: ${v}`)
                            .join('; ');
                        document.getElementById('authHeader').value = headers;
                    } else {
                        document.getElementById('authHeader').value = '';
                    }
                    
                    // Handle cookies
                    if (data.config.cookies && Object.keys(data.config.cookies).length > 0) {
                        const cookies = Object.entries(data.config.cookies)
                            .map(([k, v]) => `${k}=${v}`)
                            .join('; ');
                        document.getElementById('cookies').value = cookies;
                    } else {
                        document.getElementById('cookies').value = '';
                    }
                    
                    currentProfileName = name;
                    document.getElementById('deleteProfileBtn').style.display = 'flex';
                    
                    addLog(`üìÅ Loaded profile: ${name}`);
                }
            } catch (err) {
                showToast('Failed to load profile', 'error');
            }
        }

        async function loadRecordProfile(name) {
            // Load profile into Record Mode fields
            if (!name) return;
            
            try {
                const response = await fetch(`/api/profiles/${encodeURIComponent(name)}`);
                const data = await response.json();
                
                if (data.config) {
                    // Fill Record Mode form with profile data
                    document.getElementById('recordUrl').value = data.config.url || '';
                    document.getElementById('recordLoginUrl').value = data.config.login_url || '';
                    document.getElementById('recordUsername').value = data.config.username || '';
                    document.getElementById('recordPassword').value = data.config.password || '';
                    
                    showToast(`Loaded "${name}" into Record Mode`, 'success');
                    addLog(`üìÅ Loaded profile for Record Mode: ${name}`);
                }
            } catch (err) {
                showToast('Failed to load profile', 'error');
            }
        }

        function showSaveProfileModal() {
            document.getElementById('saveProfileModal').classList.add('active');
            document.getElementById('profileName').value = currentProfileName || '';
            document.getElementById('profileDescription').value = '';
            document.getElementById('profileName').focus();
        }

        function hideSaveProfileModal() {
            document.getElementById('saveProfileModal').classList.remove('active');
        }

        async function saveCurrentProfile() {
            const name = document.getElementById('profileName').value.trim();
            const description = document.getElementById('profileDescription').value.trim();
            
            if (!name) {
                showToast('Please enter a profile name', 'error');
                return;
            }
            
            // Get current form values
            const config = {
                url: document.getElementById('url').value,
                login_url: document.getElementById('loginUrl').value || null,
                username: document.getElementById('username').value || null,
                password: document.getElementById('password').value || null,
                max_pages: parseInt(document.getElementById('maxPages').value),
                max_depth: parseInt(document.getElementById('maxDepth').value),
                wait_time: parseInt(document.getElementById('waitTime').value),
                headless: document.getElementById('headless').checked,
                auth_headers: {},
                cookies: {},
            };
            
            // Parse auth header
            const authHeader = document.getElementById('authHeader').value;
            if (authHeader && authHeader.includes(':')) {
                const [headerName, ...valueParts] = authHeader.split(':');
                config.auth_headers[headerName.trim()] = valueParts.join(':').trim();
            }
            
            // Parse cookies
            const cookiesStr = document.getElementById('cookies').value;
            if (cookiesStr) {
                cookiesStr.split(';').forEach(cookie => {
                    const [cookieName, value] = cookie.split('=');
                    if (cookieName && value) {
                        config.cookies[cookieName.trim()] = value.trim();
                    }
                });
            }
            
            try {
                const response = await fetch('/api/profiles', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, description, config }),
                });
                
                if (response.ok) {
                    hideSaveProfileModal();
                    await loadProfiles();
                    document.getElementById('profileSelect').value = name;
                    currentProfileName = name;
                    document.getElementById('deleteProfileBtn').style.display = 'flex';
                    addLog(`üíæ Profile saved: ${name}`);
                    showToast(`Profile "${name}" saved successfully!`, 'success');
                } else {
                    const error = await response.json();
                    showToast(error.error || 'Failed to save profile', 'error');
                }
            } catch (err) {
                showToast('Failed to save profile', 'error');
            }
        }

        async function deleteCurrentProfile() {
            if (!currentProfileName) return;
            
            if (!confirm(`Are you sure you want to delete profile "${currentProfileName}"?`)) {
                return;
            }
            
            try {
                const response = await fetch(`/api/profiles/${encodeURIComponent(currentProfileName)}`, {
                    method: 'DELETE',
                });
                
                if (response.ok) {
                    addLog(`üóëÔ∏è Profile deleted: ${currentProfileName}`);
                    currentProfileName = null;
                    document.getElementById('profileSelect').value = '';
                    document.getElementById('deleteProfileBtn').style.display = 'none';
                    await loadProfiles();
                } else {
                    showToast('Failed to delete profile', 'error');
                }
            } catch (err) {
                showToast('Failed to delete profile', 'error');
            }
        }

        // Initialize
        connectWebSocket();
        loadProfiles();
    </script>
</body>
</html>
